# 班车预约系统

一个完整的班车预约管理系统，包含用户端和管理员后台，支持班车查询、预约、管理等功能。

## 功能特性

### 用户端功能

1. **用户注册与登录**
   - 实名制注册（姓名、学号必填）
   - 安全的用户认证系统

2. **班车查询**
   - 查看可预约班次列表
   - 默认班车安排：
     - 周一、三、五：紫金港校区 ↔ 长兴试验基地（班车A，16座）
     - 周二、四：紫金港校区 ↔ 余杭试验基地（班车B，14座）
   - 实时显示座位余量

3. **班车预约**
   - 支持去程、回程、往返选择
   - 可预约多个座位（无限制）
   - 发车前72小时开放预约
   - 自动生成乘车码

4. **预约管理**
   - 查看个人预约记录
   - 发车前可取消预约
   - 上车后30分钟内确认乘车

5. **违约管理**
   - 违约3次自动禁用账户
   - 取消预约6次自动禁用账户
   - 支持申诉恢复功能

### 管理员后台功能

1. **数据概览**
   - 活跃班车路线统计
   - 今日预约数量
   - 待处理申诉数量
   - 总用户数统计

2. **班车管理**
   - 添加/编辑班车路线
   - 设置班车时间、座位数
   - 配置运行日期
   - 启用/禁用路线

3. **预约记录管理**
   - 查看所有预约记录
   - 实时监控预约状态
   - 用户信息查看

4. **申诉审核**
   - 处理用户申诉请求
   - 恢复被禁用账户
   - 申诉记录管理

## 技术栈

- **后端**: Python + Flask
- **数据库**: SQLite3
- **前端**: 原生HTML/CSS/JavaScript
- **认证**: JWT Token (Flask-JWT-Extended)
- **密码加密**: bcrypt
- **跨域支持**: Flask-CORS

## 安装与运行

### 1. 安装依赖

```bash
pip install -r requirements.txt
```

### 2. 启动服务器

```bash
python app.py
```

### 3. 访问系统

- 用户端：http://localhost:8000
- 管理后台：http://localhost:8000/admin

## 默认账户

### 管理员账户
- 用户名：admin
- 密码：admin123

## 系统规则

### 预约规则

1. **时间限制**：发车前72小时开放预约，发车当天早上7:30前关闭预约通道

2. **座位管理**：
   - 实名制预约
   - 一人可预约多座（不设限）
   - 满座时提示不可预约
   - 座位余量动态显示

3. **乘车确认**：
   - 预约成功后自动生成乘车码
   - 上车后30分钟内必须确认上车
   - 未确认视为违约

### 违约处理

1. **违约记录**：
   - 未确认上车记录为违约
   - 违约3次自动禁用预约资格

2. **取消预约**：
   - 发车前可取消预约
   - 取消6次自动禁用预约资格

3. **申诉恢复**：
   - 被禁用用户可提交申诉
   - 管理员审核通过后恢复资格
   - 恢复后违约和取消次数清零

## 数据库结构

### 用户表 (users)
- 用户基本信息
- 违约次数统计
- 账户状态管理

### 班车路线表 (bus_routes)
- 路线基本信息
- 时间和座位配置
- 运行日期设置

### 预约记录表 (reservations)
- 预约详细信息
- 乘车码管理
- 状态跟踪

### 申诉记录表 (appeals)
- 申诉内容
- 处理状态
- 管理员回复

## API接口

### 用户接口
- POST /api/register - 用户注册
- POST /api/login - 用户登录
- GET /api/routes/:date - 获取指定日期班车
- POST /api/reservations - 创建预约
- GET /api/my-reservations - 获取个人预约
- PUT /api/reservations/:id/cancel - 取消预约
- PUT /api/reservations/:id/confirm - 确认上车
- POST /api/appeals - 提交申诉

### 管理员接口
- GET /api/admin/routes - 获取所有路线
- POST /api/admin/routes - 添加路线
- PUT /api/admin/routes/:id - 更新路线
- GET /api/admin/reservations - 获取所有预约
- GET /api/admin/appeals - 获取所有申诉
- PUT /api/admin/appeals/:id - 处理申诉

## 安全特性

1. **密码安全**：使用bcryptjs加密存储
2. **JWT认证**：安全的token认证机制
3. **权限控制**：管理员和普通用户权限分离
4. **数据验证**：完整的输入数据验证
5. **SQL注入防护**：使用参数化查询

## 部署说明

1. 确保Python环境（建议v3.7+）
2. 安装项目依赖：`pip install -r requirements.txt`
3. 启动服务器：`python app.py`
4. 数据库会自动初始化
5. 访问系统进行使用

## 开发说明

### 目录结构
```
├── app.py             # Flask服务器主文件
├── requirements.txt   # Python依赖配置
├── public/           # 静态文件
│   ├── index.html    # 用户端页面
│   └── admin.html    # 管理后台页面
└── bus_reservation.db # SQLite数据库文件（自动生成）
```

### 自定义配置

可以通过修改server.js中的配置来调整：
- 端口号（默认3000）
- JWT密钥
- 数据库文件路径
- 默认班车设置

## 许可证

MIT License